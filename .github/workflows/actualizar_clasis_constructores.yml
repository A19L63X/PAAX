name: Actualizar clasis_constructores.html

  on:
ย   schedule:
ยยย   - cron: '0 18 * * 0'ย # Domingos a las 20:00 CEST (18:00 UTC)
ย   workflow_dispatch:ย # Solo ejecuciรณn manual, no automรกtica con push
    push:
ยยย   branches:
ยยยยย   - 'never-run'ย # Rama ficticia para que no se ejecute en push a main
jobs:
ย update_clasificacion_constructores:
ยยย runs-on: ubuntu-latest
ยยย timeout-minutes: 10ย # Evita ejecuciones infinitas
ยยย steps:
ยยย - name: Checkout repository
ยยยยย uses: actions/checkout@v4ย # Correcto: checkout del repositorio

ยยย - name: Set up Python
ยยยยย uses: actions/setup-python@v5
ยยยยย with:
ยยยยยยย python-version: '3.13'ย # ยกMisma versiรณn que usas localmente!

ยยย - name: Instalar dependencias exactas
ยยยยย run: |
ยยยยยยย python -m pip install --upgrade pip
ยยยยยยย pip install fastf1==3.1.0 requests==2.31.0ย # Versiones fijas como en tu local

ยยย - name: Run f1_data.py para actualizar datos base
ยยยยย run: python f1_data.pyย # Comando para ejecutar el script f1_data.py

ยยย - name: Generar tabla de constructores (clasis_constructores.html)
ยยยยย run: python generar_tabla_constructores.pyย # Comando para ejecutar el script de la tabla

ยยย - name: Verificar cambios reales
ยยยยย id: check-changes
ยยยยย run: |
ยยยยยยย if git diff --quiet clasis_constructores.html; then
ยยยยยยยยย echo "changes_detected=false" >> $GITHUB_OUTPUT
ยยยยยยยยย echo "๐ข No hay cambios en clasis_constructores.html"
ยยยยยยย else
ยยยยยยยยย echo "changes_detected=true" >> $GITHUB_OUTPUT
ยยยยยยยยย echo "๐ต Cambios detectados en:"
ยยยยยยยยย git diff --name-only clasis_constructores.html
ยยยยยยย fi

ยยย - name: Configurar Git (solo si hay cambios)
ยยยยย if: steps.check-changes.outputs.changes_detected == 'true'
ยยยยย run: |
ยยยยยยย git config --global user.name "GitHub Actions"
ยยยยยยย git config --global user.email "actions@github.com"
ยยยยยยย git config --global core.autocrlf falseย # Evita problemas de saltos de lรญnea

ยยย - name: Hacer Commit y Push (solo si hubo cambios)
ยยยยย if: steps.check-changes.outputs.changes_detected == 'true'
ยยยยย run: |
ยยยยยยย git add clasis_constructores.html
ยยยยยยย git commit -m "๐ค Actualizaciรณn automรกtica constructores - $(date +'%d/%m/%Y') [skip ci]"
ยยยยยยย git push origin main

ยยย - name: Notificar resultado
ยยยยย run: |
ยยยยยยย if [ "${{ steps.check-changes.outputs.changes_detected }}" == "true" ]; then
ยยยยยยยยย echo "โ Se actualizรณ clasis_constructores.html SIN perder formato"
ยยยยยยย else
ยยยยยยยยย echo "โน๏ธ No hubo cambios en los datos fuente para constructores"
ยยยยยยย fi