<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Top 24 Artistas Globales - Last.fm</title>
    <style>
        :root {
            --bg-color: #0f0f0f;
            --card-bg: #181818;
            --text-color: #fff;
            --accent: #1DB954;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: var(--accent);
            margin: 40px 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .artist-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            overflow: hidden;
        }

        .artist-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .artist-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #2a2a2a, #1a1a1a);
        }

        .artist-name {
            font-weight: bold;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 1.1em;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            color: #888;
            font-size: 0.9em;
        }

        .stats span {
            transition: color 0.3s;
        }

        .artist-card:hover .stats span {
            color: var(--accent);
        }
    </style>
</head>
<body>
    <h1>游꿚 Top 24 Artistas Globales</h1>
    <div class="grid" id="artistsContainer"></div>

<script>
// Configuraci칩n
const API_KEY = 'df6a2aca44246cb61eb053e38d7d2a8a';
const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
const API_URL = `https://ws.audioscrobbler.com/2.0/?method=chart.gettopartists&api_key=${API_KEY}&format=json&limit=24`;

// Mapeo manual para im치genes problem치ticas
const IMAGENES_MANUALES = {
    'Drake': 'https://upload.wikimedia.org/wikipedia/commons/b/bc/Drake_2021_%28cropped%29.jpg',
    'The Weeknd': 'https://upload.wikimedia.org/wikipedia/commons/3/3f/The_Weeknd_2018.png'
};

async function obtenerImagen(artista) {
    // 1. Verificar mapeo manual primero
    if (IMAGENES_MANUALES[artista.name]) {
        return IMAGENES_MANUALES[artista.name];
    }
    
    // 2. Buscar en Wikipedia
    try {
        const wikiResponse = await fetch(
            `https://es.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(artista.name)}&prop=pageimages&format=json&pithumbsize=500&origin=*`
        );
        const wikiData = await wikiResponse.json();
        const page = Object.values(wikiData.query.pages)[0];
        if (page.thumbnail) {
            return page.thumbnail.source;
        }
    } catch (e) {}

    // 3. Buscar en DuckDuckGo
    try {
        const ddgResponse = await fetch(
            `https://duckduckgo.com/?q=${encodeURIComponent(artista.name)}+musica+site:wikimedia.org&iax=images&ia=images`
        );
        const text = await ddgResponse.text();
        const images = text.match(/https:\/\/[^"]+\.(jpg|jpeg|png)/gi) || [];
        return images[0] || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg';
    } catch (e) {}

    // 4. 칔ltimo recurso: Last.fm con proxy
    const imagenLastFM = artista.image.find(img => img.size === 'extralarge')?.['#text'] || '';
    return imagenLastFM ? `${CORS_PROXY}${encodeURIComponent(imagenLastFM)}` : 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg';
}

async function cargarArtistas() {
    try {
        const response = await fetch(`${CORS_PROXY}${encodeURIComponent(API_URL)}`);
        const data = await response.json();
        
        const artistas = await Promise.all(data.artists.artist.map(async artista => ({
            nombre: artista.name,
            oyentes: parseInt(artista.listeners).toLocaleString('es'),
            reproducciones: parseInt(artista.playcount).toLocaleString('es'),
            imagen: await obtenerImagen(artista),
            url: artista.url
        })));

        mostrarArtistas(artistas);
        
    } catch (error) {
        document.getElementById('artistsContainer').innerHTML = `
            <div style="color: #ff4444; text-align: center; padding: 50px;">
                <h2>丘멆잺 Error de conexi칩n</h2>
                <p>Recarga la p치gina o intenta m치s tarde</p>
                <button onclick="window.location.reload()" 
                        style="margin-top: 20px; padding: 10px 20px; 
                               background: var(--accent); border: none; 
                               border-radius: 8px; cursor: pointer;">
                    Recargar
                </button>
            </div>
        `;
    }
}

function mostrarArtistas(artistas) {
    const container = document.getElementById('artistsContainer');
    container.innerHTML = artistas.map(artista => `
        <div class="artist-card" onclick="window.open('${artista.url}', '_blank')">
            <img class="artist-img"
                 src="${artista.imagen}"
                 alt="${artista.nombre}"
                 loading="lazy"
                 onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'">
            <div class="artist-name">${artista.nombre}</div>
            <div class="stats">
                <span title="Usuarios 칰nicos que escucharon al artista">游논 ${artista.oyentes}</span>
                <span title="Reproducciones totales registradas">郊윒잺 ${artista.reproducciones}</span>
            </div>
        </div>
    `).join('');
}

// Iniciar autom치ticamente
document.addEventListener('DOMContentLoaded', cargarArtistas);
</script>
</body>
</html>